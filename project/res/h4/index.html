<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Netty StartUp - WebChat</title>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <style>
    body {
      margin: 10px auto;
      max-width: 900px;
    }
    #messages {
      width: 100%;
      height: 300px;
      padding: 5px;
      box-sizing: border-box;
      background-color: #eee;
      line-height: 1.4;
      overflow-y: scroll;
    }
    #messages cite {
      display: inline-block;
      width: 80px;
    }
  </style>
</head>
<body ng-app="chatApp">
  <header>
    <h2>데모</h2>
  </header>
  <main class="pure-g" ng-controller="ChatCtrl">
    <section class="pure-u-4-5">
      <div id="messages" class="pure-u-1">
        <div ng-repeat="msg in messages">
          <cite>{{ msg.nick }}</cite>
          {{ msg.text }}
        </div>
        <div style="height: 30px;" buffer-for-scroll></div>
      </div>
      <form class="pure-form pure-g">
        <div class="pure-u-1-5">
          <input class="pure-input-1" type="text" placeholder="대화명" ng-model="nick">
        </div>
        <div class="pure-u-3-5">
          <input class="pure-input-1" type="text" name="text" placeholder="메시지" autofocus ng-model="text" ng-keydown="keydown($event)">
        </div>
        <div class="pure-u-1-5">
          <button type="submit" class="pure-u-1 pure-button pure-button-primary" style="height: 36px;" ng-click="send()">
            <i class="fa fa-comment"> 보내기</i>
          </button>
        </div>  
      </form>        
    </section>
    <aside class="pure-u-1-5">
    <h3>참가자</h3>
    </aside>
  </main>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <script type="text/javascript">
    var app = angular.module("chatApp", []);
    app.controller("ChatCtrl", function($scope) {
      var h = $scope.history = [];
      h.push = function(text) {
        Array.prototype.push.call(this, text);
        this.historyIdx = this.length - 1;
      };
      h.prev = function() {
        if (this.length == 0) return "";
        this.historyIdx = (this.historyIdx + this.length) % this.length;
        return this[this.historyIdx--];
      };
      $scope.messages = [
        {nick: "대현", text: "안녕하세요"}, 
        {nick: "창열", text: "오냐"}
      ];
      $scope.send = function() {
        $scope.history.push($scope.text);
        $scope.messages.push({nick: $scope.nick, text: $scope.text});
        console.log($scope.history);
        var area = document.getElementById("messages");
        area.scrollTop = area.scrollHeight;
        $scope.text = "";
      }
      $scope.keydown = function($event) {
        if ($event.keyCode == 38) { // 커서 위방향
          $scope.text = $scope.history.prev()
        } else {
          return false;
        }
      };
    });
  </script>

</body>
</html>